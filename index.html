// --- è¼‰å…¥çµ±è¨ˆ (ä¿®æ­£å¾Œçš„é‚è¼¯) ---
async function loadStats(eventId) {
  try {
    const data = await callApi('queryStats', `&eventId=${eventId}`);
    const isWeiYa = $('eventSelect').selectedOptions[0].dataset.type === 'å°¾ç‰™';
    
    // 1. ç¸½äººæ•¸çµ±è¨ˆ
    let total = 0;
    data.users.forEach(u => total += parseInt(u.people)||0);
    $('userStats').innerHTML = `<strong>ğŸ‘¥ å ±åç¸½äººæ•¸ï¼š${total} äºº</strong><br>` + 
      data.users.map(u => `${u.userName}(${u.people}äºº)`).join(', ');

    // 2. è©³ç´°çµ±è¨ˆ (æ¡Œæ•¸/æˆ¿å‹)
    let detail = `<strong>${isWeiYa ? 'ğŸ—„ï¸ æ¡Œæ•¸çµ±è¨ˆ' : 'ğŸ¨ æˆ¿å‹çµ±è¨ˆ'}ï¼š</strong><br>`;
    const target = isWeiYa ? data.tableStats : data.roomStats;
    
    // ğŸ’¡ ä¿®æ­£é»ï¼šè‡ªå‹•åˆ¤æ–·å–®ä½ï¼Œé¿å…é‡è¤‡é¡¯ç¤ºã€Œæ¡Œã€æˆ–é¡¯ç¤ºç©ºç™½ã€Œ: 1 æ¡Œã€
    const keys = Object.keys(target).filter(k => k.trim() !== "" && k !== "undefined");
    
    if(keys.length > 0) {
      for(let k in target) {
        if (!k || k.trim() === "" || k === "undefined") continue; // å†æ¬¡å¼·åŠ›éæ¿¾ç©ºéµå€¼
        
        // å¦‚æœå¾Œç«¯å‚³ä¾†çš„åç¨±å·²ç¶“åŒ…å«ã€Œæ¡Œã€æˆ–ã€Œé–“ã€ï¼Œå°±ä¸å†è£œå–®ä½
        let displayUnit = "";
        if (isWeiYa && !k.includes("æ¡Œ")) displayUnit = " æ¡Œ";
        if (!isWeiYa && !k.includes("é–“") && !k.includes("æˆ¿")) displayUnit = " é–“";
        
        detail += `â€¢ ${k}: ${target[k]}${displayUnit}<br>`;
      }
    } else {
      detail += 'æš«ç„¡è³‡æ–™';
    }
    $('detailStats').innerHTML = detail;

    // 3. è´ŠåŠ©çµ±è¨ˆ
    let sp = `<strong>ğŸ è´ŠåŠ©çµ±è¨ˆï¼š</strong><br>`;
    const spKeys = Object.keys(data.sponsor).filter(k => k.trim() !== "");
    if(spKeys.length > 0) {
      for(let k in data.sponsor) {
        if (!k || k.trim() === "") continue;
        sp += `â€¢ ${k}: ${data.sponsor[k]}<br>`;
      }
    } else {
      sp += 'æš«ç„¡è´ŠåŠ©';
    }
    $('sponsorStats').innerHTML = sp;
  } catch(e) { 
    console.error('çµ±è¨ˆæ›´æ–°å¤±æ•—', e); 
  }
}
